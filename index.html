<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام استعلام عن الطالب</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
body { font-family: 'Cairo', sans-serif; direction: rtl; margin:0; padding:0; background: linear-gradient(to bottom,#e0f0ff,#ffffff);}
header { background:#007bff; color:#fff; text-align:center; padding:25px 10px; font-size:24px; font-weight:bold;}
header span { display:block; font-size:16px; font-weight:normal; margin-top:5px; opacity:0.8;}
.input-group { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; margin:20px 0;}
.input-group input { flex:0 0 160px; padding:10px; font-size:14px; border-radius:8px; border:1px solid #ccc;}
.input-group input:focus { outline:none; border-color:#007bff; box-shadow:0 0 8px rgba(0,123,255,0.3);}
button { padding:10px 25px; font-size:14px; border:none; border-radius:8px; background:#28a745; color:#fff; cursor:pointer;}
button:hover { background:#218838; transform:scale(1.05);}
.year-label { text-align:center; font-size:14px; color:#555; margin-bottom:20px; opacity:0.8;}
.container { max-width:1200px; margin:0 auto 30px auto; padding:10px; display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:20px; justify-items:center;}
.section { width:100%; min-height:300px; background:#fff; border-radius:15px; padding:15px; box-shadow:0 10px 30px rgba(0,0,0,0.15); font-family:'Cairo',sans-serif; font-size:14px; overflow-x:auto;}
.section h3 { text-align:center; color:#fff; font-size:18px; border-radius:10px; padding:10px 0; margin-bottom:15px;}
.grades { background:#ffc107; color:#000; font-size:13px; }
table { width:100%; border-collapse:collapse; table-layout:fixed;}
th, td { padding:6px 4px; text-align:center; border:1px solid #ddd; word-wrap:break-word;}
tr:hover { background-color: rgba(0,123,255,0.1);}
.governance { margin-top:20px; background:#343a40; color:#fff; padding:20px; border-radius:15px; text-align:center;}
.version { text-align:center; margin-top:10px; font-size:12px; color:#555;}
@media (max-width:768px) { .input-group input { flex:0 0 140px; } th, td { font-size:12px; padding:4px;} .container { grid-template-columns:1fr; } .section { min-height:auto; } }
</style>
</head>
<body>

<header>
🎓 ثانوية التحدي الأهلية
<span>العام الدراسي 2025-2026</span>
</header>

<div class="input-group">
<input id="parentNumber" placeholder="أدخل رقم ولي الأمر">
<input id="studentCode" placeholder="أدخل كود الطالب">
<button onclick="searchStudent()">بحث</button>
</div>

<div class="year-label">العام الدراسي 2025-2026</div>
<div class="container" id="output"></div>
<div class="version">الإصدار V0.1.2</div>
<div class="governance">
قسم الحوكمة: جميع الحقوق محفوظة © ثانوية التحدي الأهلية
</div>

<script>
async function searchStudent(saveToStorage=true){
  const code = document.getElementById("studentCode").value.trim();
  const parent = document.getElementById("parentNumber").value.trim();
  const output = document.getElementById("output");
  if(!parent || !code){
    output.innerHTML = "<p style='color:#dc3545; text-align:center;'>⚠️ الرجاء إدخال رقم ولي الأمر وكود الطالب لعرض النتائج.</p>";
    return;
  }

  if(saveToStorage){
    localStorage.setItem("studentCode", code);
    localStorage.setItem("parentNumber", parent);
  }

  output.innerHTML = "<p style='text-align:center;'>⏳ جاري البحث...</p>";

  const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vReghaYoMk3f8ffSBLRHIwZieEWCfk5Yx8W6c843TXkC6wpA78Z0X5nw21RRpxMdQ/pub?gid=1229272896&single=true&output=csv";

  try {
    const resp = await fetch(sheetURL);
    const text = await resp.text();
    const rows = text.split("\n").map(r=>r.split(","));
    const header = rows[0].map(h=>h.trim());
    const dataRows = rows.slice(1);
    const students = dataRows.map(r=>{
      const obj={};
      for(let i=0;i<header.length;i++) obj[header[i]]=(r[i]||"").trim();
      return obj;
    });

    const student = students.find(s => s["كود الطالب"]===code && s["رقم ولي الامر"]===parent);
    if(!student){ output.innerHTML="<p style='color:#dc3545; text-align:center;'>❌ لم أجد بيانات تطابق البحث.</p>"; return; }

    let html = "";

    // المواد والفترات (10 أعمدة لكل مادة)
    const subjects = {
      "الاسلامية": ["AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL"],
      "عربي": ["AM","AN","AO","AP","AQ","AR","AS","AT","AU","AV"],
      "الانكليزي": ["AW","AX","AY","AZ","BA","BB","BC","BD","BE","BF"],
      "الرياضيات": ["BG","BH","BI","BJ","BK","BL","BM","BN","BO","BP"],
      "الكيمياء": ["BQ","BR","BS","BT","BU","BV","BW","BX","BY","BZ"],
      "الفيزياء": ["CA","CB","CC","CD","CE","CF","CG","CH","CI","CJ"],
      "الاحياء": ["CK","CL","CM","CN","CO","CP","CQ","CR","CS","CT"],
      "اجتماعيات": ["CU","CV","CW","CX","CY","CZ","DA","DB","DC","DD"],
      "حاسوب": ["DE","DF","DG","DH","DI","DJ","DK","DL","DM","DN"],
      "رياضة": ["DO","DP","DQ","DR","DS","DT","DU","DV","DW","DX"],
      "فنية": ["DY","DZ","EA","EB","EC","ED","EE","EF","EG","EH"],
      "السلوك": ["EI","EJ","EK","EL","EM","EN","EO","EP","EQ","ER"]
    };

    for(const subject in subjects){
      html += `<div class="section grades"><h3>${subject}</h3><table><tr>`;
      // رؤوس الأعمدة: الفترات الحقيقية
      subjects[subject].forEach(col=>{
        html += `<th>${header[header.indexOf(col)]||col}</th>`;
      });
      html += "</tr><tr>";
      // درجات الطالب
      subjects[subject].forEach(col=>{
        html += `<td>${student[col]||""}</td>`;
      });
      html += "</tr></table></div>";
    }

    output.innerHTML = html;

  } catch(err){
    console.error(err);
    output.innerHTML = "<p style='color:#dc3545; text-align:center;'>❌ حدث خطأ أثناء جلب البيانات.</p>";
  }
}

// الاحتفاظ بالبيانات عند إعادة فتح الموقع
window.addEventListener("DOMContentLoaded", ()=>{
  const savedCode = localStorage.getItem("studentCode");
  const savedParent = localStorage.getItem("parentNumber");
  if(savedCode && savedParent){
    document.getElementById("studentCode").value = savedCode;
    document.getElementById("parentNumber").value = savedParent;
    searchStudent(false);
  }
});
</script>
</body>
</html>
